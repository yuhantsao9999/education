<html>

<head>
    <title>class introduction input</title>
    <link rel="stylesheet" href="./css/course_input.css" />
</head>

<body class="about">

    <div id="header">
        <div class="full-width container clearfix">
            <div>
                <div class="nav_item_bar">
                    <a href="./index.html"> <img id="logo" src="./img/logo.png" alt="logo"></a>
                    <a class="search" href="">探索</a>
                    <!-- <input id="search" style="font-size:20px" onkeyup="search_course_enter()"> -->
                    <div class="search__container">
                        <input class="search__input" type="text" placeholder="Search" onkeyup="search_course_enter()">
                    </div>
                    <button onclick="search_course()" type="submit"></button>
                    <div id="nav" class="col-8">
                        <ul id="clearfix" class="clearfix">
                            <li class="active"><a href="./index.html">> 返回學生頁面</a></li>
                            <li class="boundary"><a href="./profile_teacher.html">我的課程</a></li>
                            <!-- <li class="boundary"><a href="./sign_in.html">登入</a></li>
                                    <li><a href="./sign_up.html"><i class="icon-search"></i> 註冊</a></li> -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="content">
        <div class="header">
        </div>

        <!------- 內容 ------->

        <div class="total_container">
            <div class="container">
                <form action='/education/class_input' method='POST' enctype="multipart/form-data">
                    <div id="maininfo">
                        <div class="row-maininfo">
                            <p><b>想一個課程標題如何？</b></p><input type='text' name='course_title'>
                            <p>吸引人的標題很重要</p>
                        </div>
                        <div class="row-maininfo">
                            <p><b>
                                        哪個類別最適合您所分享的知識？</b></p><input type='text' name='field'></div>
                        <div class="row-maininfo">
                            <p><b>來張課程的封面照片吧！</b></p>
                            <input style="border:none;width: 300px;padding: 0 0" class="image" type='file' name='main_image' src="./img/picture.png">
                            <!-- <img class="picture" src="./img/picture.png" alt=""> -->

                            <p>檔案格式僅支援 jpg, png, gif</p>
                        </div>



                    </div>
                    <div id="subinfo">
                        <div class="row-maininfo">
                            <p><b>關於講師</b></p><textarea style="width:246px;height:100px;" type='text' name='course_teacher_intro'></textarea>
                            <p>讓學生更近一步了解授課老師的背景增吧！</p>

                        </div>

                        <div class="row-maininfo">
                            <p><b>簡短的課程描述（建議 64 字內）</b></p><textarea style="width:246px;height:100px;" type='text' name='course_intro'></textarea></div>
                        <div class="row-maininfo">
                            <p><b>哪些學生適合這堂課？</b></p><textarea style="width:246px;height:100px;" type='text' name='for_who'></textarea>
                            <p>形容這堂課適合的學生族群，可以更讓學生了解課程內容的方向</p>
                        </div>
                    </div>

                    <div id="videoinfo">
                        <!-- <div id="1">
                            <div class="chapter">
                                <div id="chapter_title" class="row-video">
                                    <p><b>chapter title:</b></p>
                                    <input type='text' name='chapter_title' required><br><br>
                                </div>
                                <div class="button">
                                    <input type="button" value="Add section" onclick="add_section()">
                                </div>
                                <span><img src="../img/delete.png" alt="delete" onclick="delete_chapter()"></span>
                            </div>
                            <div class="section">
                                <div id="section_title" class="row-video">
                                    <p><b>section title:</b></p><input type='text' name='section_title' required>
                                </div>
                                <div id="section_intro" class="row-video">
                                    <p><b>section introduction:</b></p><input type='text' name='section_intro' required>
                                </div>
                                <div class="row-video">
                                    <p>
                                        <b>
                                                video:
                                                </b>
                                    </p>
                                    <input type='file' name='class_video' required>
                                </div>
                                <span><img src="../img/delete3.png" alt="delete" onclick="delete_video()"></span>
                            </div>
                        </div> -->
                    </div>

                    <div>
                        <input type="button" value="Add chapter" onclick="add_chapter()">
                        <input type="hidden" id="chapter_num" name="chapter_num">
                        <!-- <input type="hidden" id="video_count" name="video_count"> -->
                        <input type="hidden" id="each_chapter_section_num" name="each_chapter_section_num">
                        <input type="hidden" id="user_token" name="user_token">
                        <input type='submit' value='Submit' id="submit">
                    </div>
                </form>

            </div>
        </div>
    </div>

</body>
<script>
    var count = 0;
    var video_count = 0; //vidoe的編號 非個數
    function add_section(obj) {
        video_count++;
        var section_titleDiv = document.createElement("div");
        section_titleDiv.className = "row-video";
        var section_titleContent = document.createTextNode("section title:");
        var section_titleP = document.createElement("p");
        section_titleP.appendChild(section_titleContent);
        section_titleDiv.appendChild(section_titleP);
        var section_title_input = document.createElement("input");
        section_title_input.id = "section_title"
        section_title_input.type = "text";
        section_title_input.name = "section_title";
        section_titleDiv.appendChild(section_title_input)
        var section_introDiv = document.createElement("div");
        section_introDiv.className = "row-video";
        var section_introContent = document.createTextNode("section introduction:");
        var section_introP = document.createElement("p");
        section_introP.appendChild(section_introContent);
        section_introDiv.appendChild(section_introP);
        var section_intro_textarea = document.createElement("textarea");
        section_intro_textarea.id = "section_intro"
        section_intro_textarea.style = "width:246px;height:100px;"
        section_intro_textarea.type = "text";
        section_intro_textarea.name = "section_intro";
        section_introDiv.appendChild(section_intro_textarea)
        var deleteSpan = document.createElement("span");
        var deleteImg = document.createElement("img");
        deleteImg.src = "../img/delete3.png"
        deleteImg.className = count
        deleteImg.setAttribute("onClick", "delete_section(" + video_count + ")");
        deleteSpan.appendChild(deleteImg);
        var videoDiv = document.createElement("div");
        videoDiv.className = "row-video"
        var videomainp = document.createElement("p");
        var videoContent = document.createTextNode("video:");
        videomainp.appendChild(videoContent);
        videoDiv.appendChild(videomainp);
        var videoinput = document.createElement("input");
        videoinput.type = "file";
        videoinput.name = "class_video";
        videoDiv.appendChild(videoinput);
        var sectionmainDiv = document.createElement("div");
        sectionmainDiv.className = "section";
        sectionmainDiv.id = "section" + video_count;
        sectionmainDiv.appendChild(section_titleDiv);
        sectionmainDiv.appendChild(section_introDiv);
        sectionmainDiv.appendChild(videoDiv);
        sectionmainDiv.appendChild(deleteSpan);
        document.getElementById(obj).appendChild(sectionmainDiv);
        console.log(video_count)
    }

    function add_chapter() {
        count++;
        // document.getElementById('count').value = count;
        var chaptermainDiv = document.createElement("div");
        chaptermainDiv.className = "chapter"
        var chapter_titleDiv = document.createElement("div");
        chapter_titleDiv.className = "row-video";
        var chapter_titleP = document.createElement("p");
        var chapter_titleContent = document.createTextNode("chapter title:");
        chapter_titleP.appendChild(chapter_titleContent);
        chapter_titleDiv.appendChild(chapter_titleP);
        var chapter_title_input = document.createElement("input");
        chapter_title_input.id = "chapter_title"
        chapter_title_input.type = "text";
        chapter_title_input.name = "chapter_title";
        chapter_titleDiv.appendChild(chapter_title_input)
        var add_sectionDiv = document.createElement("div");
        add_sectionDiv.className = "button"
        var add_sectioninput = document.createElement("input");
        add_sectioninput.value = "Add section"
        add_sectioninput.type = "button"
        add_sectioninput.setAttribute("onClick", "add_section(" + count + ")");
        add_sectionDiv.appendChild(add_sectioninput)
        var delete_chapyerSpan = document.createElement("span");
        var delete_chapyerImg = document.createElement("img");
        delete_chapyerImg.src = "../img/delete.png"
        delete_chapyerImg.className = count
        delete_chapyerImg.setAttribute("onClick", "delete_chapter(" + count + ")");
        delete_chapyerSpan.appendChild(delete_chapyerImg);
        chaptermainDiv.appendChild(chapter_titleDiv);
        chaptermainDiv.appendChild(add_sectionDiv);
        chaptermainDiv.appendChild(delete_chapyerSpan);
        var chapter_video_Div = document.createElement("div");
        chapter_video_Div.id = parseInt(count);
        chapter_video_Div.appendChild(chaptermainDiv);
        document.getElementById("videoinfo").appendChild(chapter_video_Div);
    }
    var delete_count = 0
        //delete_chapter()
    function delete_chapter(obj) {
        delete_count++;
        // document.getElementById('count').value = count;
        var delete_chapter = document.getElementById(obj);
        delete_chapter.parentNode.removeChild(delete_chapter);
    }
    //delete_section()
    function delete_section(obj) {
        video_count--;
        // document.getElementById('video_count').value = video_count;
        var delete_id = document.getElementById("section" + obj);
        delete_id.parentNode.removeChild(delete_id);
        console.log(video_count)
    }


    document.getElementById("submit").addEventListener("click", function() {
        var each_chapter_section_num_arr = [];
        // var chapter_num = Number(document.getElementById('count').value);
        var chapter_num = count - delete_count //chapter的個數
        document.getElementById('chapter_num').value = chapter_num;
        for (var i = 0; i < chapter_num; i++) {
            each_chapter_section_num_arr.push(((document.getElementsByName("chapter_title")[i]).parentNode.parentNode.parentNode.childNodes.length) - 1)
        }
        document.getElementById('each_chapter_section_num').value = each_chapter_section_num_arr;
    });

    // user_icon
    accessToken = localStorage.getItem("accessToken")
    document.getElementById("user_token").value = accessToken
    var xml_icon = new XMLHttpRequest();
    xml_icon.open("get", "/profile/getinfo", true);
    xml_icon.setRequestHeader("Authorization", "Bearer" + " " + accessToken);
    xml_icon.send(null);
    xml_icon.onreadystatechange = function() {
        if (xml_icon.readyState == 4) {
            if (xml_icon.responseText == "error") {
                //還沒登入
                // var sign_li = document.createElement("li");
                // var signContent = document.createTextNode("登入");
                // var sign_a = document.createElement("a");
                // sign_a.href = "./sign_in.html"
                // sign_a.appendChild(signContent)
                // sign_li.appendChild(sign_a)
                // document.getElementById("clearfix").appendChild(sign_li)
                alert("請先登入帳號哦!");
                window.location.assign("./sign_in.html")
            } else {
                //已登入
                var sign_li = document.createElement("li");
                var signContent = document.createTextNode("Hello!");
                var sign_a = document.createElement("a");
                sign_a.href = "./profile.html"
                sign_a.appendChild(signContent)
                sign_li.appendChild(sign_a)
                document.getElementById("clearfix").appendChild(sign_li)
            }
        }
    }
</script>

</html>