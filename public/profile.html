<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>class</title>
    <link rel="stylesheet" href="./css/profile.css" />
</head>

<body class="about">
    <div id="header">
        <div class="full-width container clearfix">
            <div>
                <div class="nav_item_bar">
                    <a href="./index.html"> <img id="logo" src="./img/logo.png" alt="logo"></a>
                    <a class="search" href="">探索</a>
                    <input id="search" style="font-size:20px">
                    <button class="search-button" onclick="search_course()" type="submit"></button>
                    <div id="nav" class="col-8">
                        <ul id="clearfix" class="clearfix">
                            <li class="active"><a href="./course_input.html">我要開課</a></li>
                            <li class="boundary"><a href="./profile.html">我的課表</a></li>
                            <!-- <li class="boundary"><a href="./sign_in.html">登入</a></li>
                            <li><a href="./sign_up.html"><i class="icon-search"></i> 註冊</a></li> -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-------大報 ------>
    <div id="content">
        <div class="header">
        </div>

        <!------- 內容 ------->

        <div class="total_container">
            <div class="content_container">
                <div class="col-4" id="table">
                    <a href="./profile_student.html">
                        <div class="profile_class">
                            我修的課
                        </div>
                    </a>
                    <a href="./profile.html">
                        <div class="user_info">
                            編輯我的公開資訊
                        </div>
                    </a>
                    <a href="./profile_done.html">
                        <div class="profile_finish">
                            已完成的課程
                        </div>
                    </a>
                    <a href="./profile_teacher.html">
                        <div class="teacher_class">
                            我開的課
                        </div>
                    </a>
                </div>

                <div class="col-12" id="profile_add_info">
                    <div class="teacher">

                        <!-- <div class="teacher_name"><b>關於老師 XXXX</b></div> -->
                        <div class="teacher_detail">
                            <div class="picture">
                                <div class="picture_circle">
                                    <!-- TODO:使用者圖片更換 -->
                                    <img src="./img/pen.png" alt="">
                                    <div id="name">
                                        <!-- <span> <input type="text" class="name" placeholder="名字" required>
                                            <img src="./img/pen.png" alt="">
                                        </span> -->

                                    </div>
                                    <!-- <div class="about_me"> -->
                                    <textarea type="text" class="about_me" rows="1" placeholder="簡單介紹一下自己吧!" onpropertychange="setHeight(this);" onpaste="setHeight(this);" oninput="setHeight(this);"></textarea>
                                </div>

                            </div>

                        </div>
                        <div class="link_content">
                            <div class="user_link">我的網站連結</div>
                            <div class="form-group" id="urlPersonalWebsite">
                                <div class="control-label">網站</div>
                                <!-- <input type="text" class="form-control" name="urlPersonalWebsite" placeholder="網址"> -->
                            </div>
                            <div class="form-group" id="facebookProfile">
                                <div class="control-label">Facebook</div>
                                <span class="input-group" id="input-group-facebook">
                                <span class="input-group-addon">http://www.facebook.com/</span>
                                <!-- <input type="text" class="form-control" name="facebookProfile" placeholder="使用者名稱"> -->
                                </span>
                            </div>
                            <div class="form-group" id="youtubeProfile">
                                <div class="control-label">YouTube</div>
                                <span class="input-group" id="input-group-youtube">
                                    <span class="input-group-addon">http://www.youtube.com/</span>
                                <!-- <input type="text" class="form-control" name="youtubeProfile" placeholder="使用者名稱"> -->
                                </span>
                            </div>
                            <div class="upload_button">
                                <button type="submit" class="btn-primary" onclick="add_user_info()"><b>儲存</b></button>
                            </div>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </div>


    <!------- footer ------->
    <div id="footer" class="dark">

        <div class="info">
            <div class="container">

                <div class="row">
                    <div class="col-3">
                        <img id="logo" src="./img/logo.png" alt="logo" />
                        <p>讓學習<br>無時無刻無距離</p>
                    </div>
                    <div class="col-3">
                        <h4 class="title">recent posts</h4>
                        <ul class="common-list">
                            <li><a href="#">standard blog post</a></li>
                            <li><a href="#">quotation post</a></li>
                            <li><a href="#">audio post</a></li>

                        </ul>
                    </div>
                    <div class="col-3">
                        <h4 class="title">快速連結</h4>
                        <ul class="common-list">
                            <li><a href="#">關於我們</a></li>
                            <li><a href="#">回到主頁</a></li>
                            <li><a href="./course_input.html">我要開課</a></li>
                        </ul>
                    </div>

                </div>

            </div>
        </div>

        <div class="bottom">
            <div class="container clearfix">

                <div class="copyright">
                    <div class="title">Copyright 2019 by <a href="#">yuhan</a> | All Rights Reserved</div>
                </div>


            </div>
        </div>
    </div>

    <a href="#header" id="go-top"><i class="icon-up-open"></i></a>

</body>
<script>
    var accessToken = localStorage.getItem("accessToken")

    //公開資料獲取目前資料
    var xml_profileInfo = new XMLHttpRequest;
    xml_profileInfo.open('get', '/profile/getinfo', true);
    xml_profileInfo.setRequestHeader("Authorization", "Bearer" + " " + accessToken);
    xml_profileInfo.send(null);
    xml_profileInfo.onreadystatechange = function() {
        if (xml_profileInfo.readyState == 4) {
            var profile_info_obj = JSON.parse(xml_profileInfo.responseText);
            console.log(profile_info_obj)
                //user名稱
            var nameInput = document.createElement("input")
            nameInput.type = "text";
            nameInput.className = "name";
            nameInput.value = (profile_info_obj.info[0].name);
            document.getElementById("name").appendChild(nameInput);
            //about_me
            var about_meContent = profile_info_obj.info[0].about_me
            if (about_meContent !== null) {
                var about_meContentNode = document.createTextNode(about_meContent);
                document.getElementsByClassName("about_me")[0].appendChild(about_meContentNode);
            }

            //PersonalWebsite
            var PersonalWebsiteInput = document.createElement("input")
            PersonalWebsiteInput.type = "text";
            PersonalWebsiteInput.className = "form-control";
            PersonalWebsiteInput.placeholder = "網址";
            PersonalWebsiteInput.name = "urlPersonalWebsite";
            var PersonalWebsiteContent = profile_info_obj.info[0].PersonalWebsite;
            PersonalWebsiteInput.value = PersonalWebsiteContent;
            document.getElementById("urlPersonalWebsite").appendChild(PersonalWebsiteInput);

            //facebookProfile
            var facebookProfileInput = document.createElement("input")
            facebookProfileInput.type = "text";
            facebookProfileInput.className = "form-control";
            facebookProfileInput.placeholder = "使用者名稱";
            facebookProfileInput.name = "facebookProfile";
            facebookProfileInput.value = profile_info_obj.info[0].facebookProfile;
            document.getElementById("input-group-facebook").appendChild(facebookProfileInput);


            //youtubeProfile
            var youtubeProfileInput = document.createElement("input")
            youtubeProfileInput.type = "text";
            youtubeProfileInput.className = "form-control";
            youtubeProfileInput.placeholder = "使用者名稱";
            youtubeProfileInput.name = "youtubeProfile";
            youtubeProfileInput.value = profile_info_obj.info[0].youtubeProfile;
            document.getElementById("input-group-youtube").appendChild(youtubeProfileInput);
        }
    }


    //公開資料確認登入以及修改
    function add_user_info() {
        var xml = new XMLHttpRequest;
        xml.open('post', '/profile/info', true);
        xml.setRequestHeader('content-type', 'application/json')
        xml.setRequestHeader("Authorization", "Bearer" + " " + accessToken);
        var user_name = document.getElementsByClassName("name")[0].value;
        var about_me = document.getElementsByClassName("about_me")[0].value;
        var urlPersonalWebsite = document.getElementsByName("urlPersonalWebsite")[0].value;
        var facebookProfile = document.getElementsByName("facebookProfile")[0].value;
        var youtubeProfile = document.getElementsByName("youtubeProfile")[0].value;

        var profile_detail = {
            user_name: user_name,
            about_me: about_me,
            PersonalWebsite: urlPersonalWebsite,
            facebookProfile: facebookProfile,
            youtubeProfile: youtubeProfile,
        }
        xml.send(JSON.stringify(profile_detail));
        alert("修改成功！")
        xml.onreadystatechange = function() {
            if (xml.readyState == 4) {
                if (xml.responseText == "error") {
                    //尚未登入會員
                    alert("please sign in first!")
                    window.location.assign('./sign_in.html');
                    //user icon
                    var sign_li = document.createElement("li");
                    var signContent = document.createTextNode("登入");
                    var sign_a = document.createElement("a");
                    sign_a.href = "./sign_in.html"
                    sign_a.appendChild(signContent)
                    sign_li.appendChild(sign_a)
                    document.getElementById("clearfix").appendChild(sign_li)
                } else {
                    //已登入會員
                    console.log("already sign in")

                }
            }
        }
    }



    //讓介紹文字自動增大
    function setHeight(obj) {
        obj.style.height = obj.scrollHeight + 'px';
    }



    //user icon
    var sign_li = document.createElement("li");
    var signContent = document.createTextNode("登出");
    var sign_a = document.createElement("a");
    sign_a.setAttribute("onClick", "log_out()");
    sign_a.appendChild(signContent)
    sign_li.appendChild(sign_a)
    document.getElementById("clearfix").appendChild(sign_li)
        //log out
    function log_out() {
        localStorage.removeItem('accessToken');
        alert("帳號登出囉!")
        window.location.replace("./sign_in.html");
    }
</script>

</html>